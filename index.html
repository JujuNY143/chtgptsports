<script>
  const espnFeeds = [
    { sport: "football", league: "nfl", label: "NFL" },
    { sport: "soccer", league: "usa.1", label: "MLS" },
    { sport: "football", league: "college-football", label: "NCAA Football" },
    { sport: "basketball", league: "mens-college-basketball", label: "NCAA MBB" }
  ];

  async function fetchGoogleSheetNews() {
    const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/PLACEHOLDER/pub?output=csv'; // replace with your link
    try {
      const res = await fetch(sheetUrl);
      const text = await res.text();
      return text.split('\n').slice(1).map(row => {
        const [headline, breaking] = row.split(',');
        return { content: headline?.trim(), breaking: breaking?.toLowerCase().includes('true') };
      });
    } catch {
      return [];
    }
  }

  async function fetchRSSNews() {
    const feeds = [
      'https://www.espn.com/espn/rss/news',
      'https://bleacherreport.com/articles/feed',
      'https://news.google.com/rss/search?q=sports'
    ];
    const allNews = [];
    for (const feed of feeds) {
      try {
        const res = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(feed)}`);
        const { contents } = await res.json();
        const parser = new DOMParser();
        const xml = parser.parseFromString(contents, "application/xml");
        const items = xml.querySelectorAll("item > title");
        items.forEach((node, i) => {
          if (i < 2) allNews.push({ content: node.textContent, breaking: false });
        });
      } catch {}
    }
    return allNews;
  }

  async function fetchESPNScores() {
    const scores = [];
    for (const { sport, league, label } of espnFeeds) {
      try {
        const res = await fetch(`https://site.api.espn.com/apis/site/v2/sports/${sport}/${league}/scoreboard`);
        const data = await res.json();
        if (!data.events) continue;

        for (const game of data.events) {
          const teams = game.competitions?.[0]?.competitors || [];
          const status = game.status?.type?.shortDetail || "TBD";
          const home = teams.find(t => t.homeAway === 'home');
          const away = teams.find(t => t.homeAway === 'away');

          scores.push({
            content: `${label}: ${away.team.shortDisplayName} ${away.score} vs ${home.team.shortDisplayName} ${home.score} (${status})`,
            breaking: false
          });
        }
      } catch (e) {
        console.error(`Failed to load ${league}`, e);
      }
    }
    return scores;
  }

  async function loadTicker() {
    const [sheetNews, rssNews, scoreData] = await Promise.all([
      fetchGoogleSheetNews(),
      fetchRSSNews(),
      fetchESPNScores()
    ]);

    const fallback = [{ content: "Follow The Bench Warmers for live updates", breaking: true }];
    const combined = [...fallback, ...scoreData, ...sheetNews, ...rssNews];

    const html = combined.map(n => `
      <div class="ticker-item">
        <div class="news-item ${n.breaking ? 'breaking' : ''}">${n.content}</div>
      </div>
    `).join('<span class="separator">â€¢</span>');

    document.getElementById("tickerContent").innerHTML = html;
  }

  loadTicker();
  setInterval(loadTicker, 300000);
</script>

