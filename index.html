<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Enhanced Sports Ticker with Fallback</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: transparent;
      overflow: hidden;
    }

    #sports-ticker {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 60px;
      background: rgba(0, 0, 0, 0.9);
      color: white;
      font-size: 26px;
      font-family: Arial, sans-serif;
      white-space: nowrap;
      overflow: hidden;
      z-index: 9999;
      display: flex;
      align-items: center;
    }

    #ticker-content {
      display: inline-block;
      padding-left: 100%;
      animation: scroll-left 25s linear infinite;
    }

    @keyframes scroll-left {
      0% { transform: translateX(0); }
      100% { transform: translateX(-100%); }
    }

    .status-live {
      color: #00ff00;
      font-weight: bold;
    }

    .status-final {
      color: #ff4444;
    }

    .status-scheduled {
      color: #ffcc00;
    }

    .breaking-news {
      color: #ff3333;
      font-weight: bold;
    }

    .game-item img {
      height: 24px;
      vertical-align: middle;
      margin-right: 6px;
    }
  </style>
</head>
<body>
  <div id="sports-ticker">
    <span id="ticker-content">Loading scores...</span>
  </div>

  <script>
    async function loadGames(date) {
      const API_KEY = '813745';
      const sports = {
        NBA: '🏀',
        MLB: '⚾',
        NFL: '🏈',
        MLS: '⚽',
        NCAAF: '🎓🏈',
        NCAAB: '🎓🏀'
      };

      const tickerEl = document.getElementById("ticker-content");
      let output = "";

      for (const sport in sports) {
        try {
          const res = await fetch(`https://www.thesportsdb.com/api/v1/json/${API_KEY}/eventsday.php?d=${date}&s=${sport}`);
          const data = await res.json();
          if (data.events) {
            for (const game of data.events) {
              const team1 = game.strHomeTeam;
              const team2 = game.strAwayTeam;
              const score1 = game.intHomeScore ?? "";
              const score2 = game.intAwayScore ?? "";
              const status = (game.strStatus ?? game.strTime ?? "Scheduled").toUpperCase();

              let statusClass = "status-scheduled";
              if (status.includes("LIVE")) statusClass = "status-live";
              else if (status.includes("FINAL")) statusClass = "status-final";

              const logo1 = `https://www.thesportsdb.com/images/media/team/badge/${(game.idHomeTeam || '0')}.png`;
              const logo2 = `https://www.thesportsdb.com/images/media/team/badge/${(game.idAwayTeam || '0')}.png`;

              output += `
                <span class="game-item">
                  ${sports[sport]} 
                  <img src="${logo1}" onerror="this.style.display='none'" alt="${team1} logo" />
                  ${team1} ${score1} - ${score2} ${team2}
                  <img src="${logo2}" onerror="this.style.display='none'" alt="${team2} logo" />
                  <span class="${statusClass}">(${status})</span> ⚡ 
                </span>
              `;
            }
          }
        } catch (err) {
          console.error(`Error fetching ${sport}`, err);
        }
      }

      // Add fallback news even if no games
      const news = [
        { content: 'MLB Trade Deadline approaching - Big moves expected', breaking: false },
        { content: 'NBA Summer League continues in Las Vegas', breaking: false },
        { content: 'NFL Training camps set to open soon', breaking: false },
        { content: '🔥 BREAKING: Follow The Bench Warmers for live sports alerts!', breaking: true }
      ];
      news.forEach(item => {
        output += `<span class="${item.breaking ? 'breaking-news' : ''}">📰 ${item.content}</span> ⚡ `;
      });

      tickerEl.innerHTML = output || "No games found today.";
    }

    async function loadTickerWithFallback() {
      const today = new Date();
      const yesterday = new Date(today);
      const tomorrow = new Date(today);
      yesterday.setDate(today.getDate() - 1);
      tomorrow.setDate(today.getDate() + 1);

      const formatDate = d => d.toISOString().split('T')[0];

      // Try today
      await loadGames(formatDate(today));

      // If still no games after small delay, try yesterday then tomorrow
      setTimeout(async () => {
        if (document.getElementById("ticker-content").innerHTML.includes("No games")) {
          await loadGames(formatDate(yesterday));
        }
      }, 1000);

      setTimeout(async () => {
        if (document.getElementById("ticker-content").innerHTML.includes("No games")) {
          await loadGames(formatDate(tomorrow));
        }
      }, 2000);
    }

    loadTickerWithFallback();
    setInterval(loadTickerWithFallback, 300000); // refresh every 5 minutes
  </script>
</body>
</html>
